version: 2.1

jobs:
 # THIS IS SECURITY SENSITVE
 # READ THESE
 # https://circleci.com/blog/deploying-documentation-to-github-pages-with-continuous-integration/
 # https://discuss.circleci.com/t/adding-ssh-keys-fails/7747/24
 deploy-github-pages:
  docker:
   - image: nixorg/nix:circleci
  steps:
   - add_ssh_keys:
      fingerprints:
       - "f2:36:f2:f9:71:9d:8f:bb:50:31:0b:ab:0e:b4:75:10"
   - checkout
   - run:
      name: Deploy github pages
      command: |
       git config user.name "$GITHUB_PAGES_DEPLOY_USER"
       git config user.email "$GITHUB_PAGES_DEPLOY_EMAIL"
       nix-shell --run nix-deploy

workflows:
 version: 2.1
 deploy:
  jobs:
   - deploy-github-pages:
      filters:
       branches:
        only: master
